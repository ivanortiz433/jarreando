<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarreando por Galicia - El Mapa de Cervezas y Tapas</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* CSS GENERAL Y DE ESCRITORIO */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #f9f9f9;
        }
        header {
            padding: 20px 10px; /* Reducimos padding horizontal */
            background-color: #ffffff;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0->0,0.05);
            z-index: 1000;
        }
        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .logo img {
            height: 150px; /* Tamaño por defecto en escritorio */
        }
        header p {
            text-align: center;
            margin: 15px 0 0; 
            color: #5f6368;
            font-size: 16px; 
        }
        
        /* SELECTOR DE CIUDAD */
        #city-selector-container {
            margin-top: 15px;
            margin-bottom: 5px;
            text-align: center;
        }
        #city-selector-container label {
            font-weight: 500;
            color: #5f6368;
            margin-right: 10px;
        }
        #city-selector {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
            font-weight: bold;
            background-color: #fff;
            cursor: pointer;
            max-width: 90%; /* Aseguramos que no se desborde */
        }

        /* FILTROS DE CERVEZA */
        #filters {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px; /* Reducimos el espacio entre logos */
            padding: 15px 10px; /* Reducimos el padding vertical */
            background-color: #f1f1f1;
            border-bottom: 1px solid #ddd;
            z-index: 1000;
            flex-wrap: wrap; /* Permitimos que los logos salten de línea */
        }
        .filter-btn {
            border: 3px solid transparent; 
            border-radius: 15px; 
            background-color: #fff;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-decoration: none;
            color: #333;
            display: flex;
            align-items: center;
        }
        .brand-logo {
            height: 70px; /* Tamaño ajustado para escritorio */
            padding: 10px;
            object-fit: contain; 
        }
        
        /* BOTÓN DE AÑADIR BAR */
        .add-bar-btn {
            background-color: #28a745;
            color: white;
            font-size: 14px; 
            padding: 10px 15px; 
            border-radius: 50px;
            text-align: center;
        }
        .add-bar-btn:hover {
            background-color: #218838;
        }
        .filter-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .filter-btn.active {
            border-color: #d93025;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        /* MAPA Y MARCADORES */
        #map {
            flex-grow: 1;
            width: 100%;
        }
        .jarra-number-marker {
            display: flex;
            align-items: center;
            background-color: white;
            border: 2px solid #d93025;
            border-radius: 15px;
            padding: 5px 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            white-space: nowrap;
            font-weight: bold;
            color: #d93025;
        }
        .jarra-number-marker img {
            height: 25px;
            width: auto;
            margin-right: 5px;
        }
        .leaflet-popup-content-wrapper {border-radius: 12px;box-shadow: 0 4px 12px rgba(0,0,0,0.15);}
        .leaflet-popup-content { margin: 18px !important; font-size: 14px; line-height: 1.6; }
        .leaflet-popup-content b { color: #d93025; font-size: 16px; display: block; margin-bottom: 4px; }
        .popup-image { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; margin-bottom: 12px; }
        .popup-link { display: block; margin-top: 8px; font-weight: bold; color: #007bff; text-decoration: none; }
        .popup-link:hover { text-decoration: underline; }
        .leaflet-routing-container {display: none;}

        /* --- CORRECCIONES RESPONSIVE ESPECÍFICAS PARA MÓVIL --- */
        @media (max-width: 768px) {
            .logo img {
                height: 100px; /* Reducimos el logo principal en móvil */
            }
            header p {
                font-size: 14px; /* Reducimos la fuente */
            }
            #filters {
                gap: 8px; /* Espacio mínimo entre elementos */
                padding: 10px 5px;
                justify-content: space-evenly; /* Distribuimos mejor los elementos */
            }
            .brand-logo {
                height: 45px; /* Hacemos los logos de cerveza más pequeños */
                padding: 5px;
                border-radius: 10px;
                border-width: 2px;
            }
            .add-bar-btn {
                font-size: 11px; /* Ajuste fino de la fuente */
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <!-- Referencia CORREGIDA al archivo original -->
            <img src="img/logo_principal.jpg" alt="Logo Jarreando por Galicia">
        </div>
        
        <div id="city-selector-container">
            <label for="city-selector">Selecciona tu ruta:</label>
            <select id="city-selector">
                <option value="galicia" selected>Toda Galicia (Top 15)</option>
                <option value="acoruna">A Coruña</option>
                <option value="ferrol">Ferrol</option>
                <option value="lugo">Lugo</option>
                <option value="ourense">Ourense</option>
                <option value="pontevedra">Pontevedra</option>
                <option value="santiago">Santiago de Compostela</option>
                <option value="vigo">Vigo</option>
            </select>
        </div>

        <p>Elige una marca de cerveza para ver el recorrido por los mejores locales.</p>
    </header>

    <div id="filters">
        <!-- Referencias CORREGIDAS a los archivos originales -->
        <img id="todos" src="img/logo_todas.jpg" alt="Ver Todos" class="filter-btn brand-logo active"> 
        <img id="estrella" src="img/logo_estrella.jpg" alt="Estrella Galicia" class="filter-btn brand-logo">
        <img id="mahou" src="img/logo_mahou.jpg" alt="Mahou" class="filter-btn brand-logo">
        <img id="aguila" src="img/logo_aguila.jpg" alt="Águila" class="filter-btn brand-logo">
        <a href="URL_DE_TU_FORMULARIO_DE_GOOGLE_AQUI" target="_blank" class="filter-btn add-bar-btn">Añade tu Bar</a>
    </div>

    <div id="map"></div>

    <script>
        // --- CÓDIGO JavaScript (script.js) INTEGRADO ---
        // --- 1. INICIALIZACIÓN DEL MAPA ---
        const map = L.map('map');
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // --- 2. BASE DE DATOS MASIVA DE GALICIA ---
        const datosGalicia = {
            ciudades: {
                galicia: { nombre: "Toda Galicia", centro: [42.8, -8.0], zoom: 8 },
                acoruna: { nombre: "A Coruña", centro: [43.368, -8.411], zoom: 14 },
                ferrol: { nombre: "Ferrol", centro: [43.484, -8.234], zoom: 14 },
                lugo: { nombre: "Lugo", centro: [43.011, -7.556], zoom: 15 },
                ourense: { nombre: "Ourense", centro: [42.336, -7.863], zoom: 14 },
                pontevedra: { nombre: "Pontevedra", centro: [42.431, -8.647], zoom: 15 },
                santiago: { nombre: "Santiago de Compostela", centro: [42.88, -8.545], zoom: 15 },
                vigo: { nombre: "Vigo", centro: [42.237, -8.722], zoom: 14 }
            },
            bares: {
                lugo: [
                    { nombre: "Mesón de Alberto", lat: 43.0118, lon: -7.5565, tapa: "Empanada gallega", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "A Nosa Terra", lat: 43.0097, lon: -7.5569, tapa: "Pulpo á feira", cerveza: "estrella", valoracion: 4.4 },
                    { nombre: "Bulló", lat: 43.008, lon: -7.558, tapa: "Gyozas de cocido", cerveza: "mahou", valoracion: 4.7 },
                    { nombre: "La Tapería", lat: 43.0092, lon: -7.5555, tapa: "Tortilla de Betanzos", cerveza: "mahou", valoracion: 4.6 },
                    { nombre: "María Castaña", lat: 43.0099, lon: -7.558, tapa: "Tosta de setas", cerveza: "aguila", valoracion: 4.7 }
                ],
                acoruna: [
                    { nombre: "O Sampaio", lat: 43.369, lon: -8.409, tapa: "Tortilla de Betanzos", cerveza: "mahou", valoracion: 4.7 },
                    { nombre: "Intenso", lat: 43.369, lon: -8.404, tapa: "Croquetas de centollo", cerveza: "aguila", valoracion: 4.7 },
                    { nombre: "A Taberna de Cunqueiro", lat: 43.370, lon: -8.406, tapa: "Raxo con patatas", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "Culuca", lat: 43.365, lon: -8.414, tapa: "Bomba de Valdeón", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "A Mundiña", lat: 43.370, lon: -8.407, tapa: "Salpicón de marisco", cerveza: "estrella", valoracion: 4.5 }
                ],
                santiago: [
                    { nombre: "Casa Marcelo", lat: 42.881, lon: -8.546, tapa: "Nigiri de vieira", cerveza: "estrella", valoracion: 4.7 },
                    { nombre: "O Curro da Parra", lat: 42.882, lon: -8.546, tapa: "Ravioli de rabo", cerveza: "mahou", valoracion: 4.6 },
                    { nombre: "O Dezaseis", lat: 42.882, lon: -8.542, tapa: "Pulpo con queso de tetilla", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "Abastos 2.0", lat: 42.881, lon: -8.541, tapa: "Producto de mercado", cerveza: "aguila", valoracion: 4.5 },
                    { nombre: "O Gato Negro", lat: 42.879, lon: -8.547, tapa: "Mejillones al vapor", cerveza: "estrella", valoracion: 4.5 }
                ],
                vigo: [
                    { nombre: "Malasangre", lat: 42.237, lon: -8.725, tapa: "Gyozas de choco", cerveza: "aguila", valoracion: 4.8 },
                    { nombre: "La Pizca", lat: 42.238, lon: -8.724, tapa: "Tosta de sardina ahumada", cerveza: "mahou", valoracion: 4.7 },
                    { nombre: "El Capitán", lat: 42.240, lon: -8.725, tapa: "Navajas a la plancha", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "Follas Novas", lat: 42.238, lon: -8.726, tapa: "Marisco de la ría", cerveza: "aguila", valoracion: 4.6 },
                    { nombre: "Casa Vella", lat: 42.240, lon: -8.724, tapa: "Calamares de la ría", cerveza: "mahou", valoracion: 4.5 }
                ],
                ourense: [
                    { nombre: "O Eironciño", lat: 42.335, lon: -7.862, tapa: "Tosta de pulpo y tetilla", cerveza: "aguila", valoracion: 4.7 },
                    { nombre: "Tizar", lat: 42.338, lon: -7.866, tapa: "Croquetas de marisco", cerveza: "mahou", valoracion: 4.6 },
                    { nombre: "A Taberna", lat: 42.337, lon: -7.863, tapa: "Oreja de cerdo", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "La Gula", lat: 42.339, lon: -7.864, tapa: "Chipirones encebollados", cerveza: "mahou", valoracion: 4.5 },
                    { nombre: "O Pote", lat: 42.336, lon: -7.864, tapa: "Setas a la plancha", cerveza: "mahou", valoracion: 4.5 }
                ],
                pontevedra: [
                    { nombre: "A Ultramar", lat: 42.434, lon: -8.646, tapa: "Conservas gourmet", cerveza: "aguila", valoracion: 4.8 },
                    { nombre: "Loaira Xantar", lat: 42.432, lon: -8.647, tapa: "Volandeira con ají", cerveza: "estrella", valoracion: 4.7 },
                    { nombre: "O Furancho", lat: 42.433, lon: -8.645, tapa: "Tabla de quesos gallegos", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "Bar Parvadas", lat: 42.433, lon: -8.647, tapa: "Mejillones tigre", cerveza: "aguila", valoracion: 4.6 },
                    { nombre: "Casa Fidel", lat: 42.431, lon: -8.648, tapa: "Calamares fritos", cerveza: "mahou", valoracion: 4.5 }
                ],
                ferrol: [
                    { nombre: "Josefa's Bar", lat: 43.482, lon: -8.237, tapa: "Tortilla jugosa", cerveza: "aguila", valoracion: 4.8 },
                    { nombre: "O Camiño do Inglés", lat: 43.483, lon: -8.236, tapa: "Pescado del día", cerveza: "estrella", valoracion: 4.7 },
                    { nombre: "A Gabeira", lat: 43.485, lon: -8.232, tapa: "Vieira a la gallega", cerveza: "estrella", valoracion: 4.6 },
                    { nombre: "A Vella Fábrica de Lapis", lat: 43.481, lon: -8.240, tapa: "Sardinas lañadas", cerveza: "aguila", valoracion: 4.6 },
                    { nombre: "Frank", lat: 43.484, lon: -8.235, tapa: "Hamburguesa gourmet", cerveza: "mahou", valoracion: 4.5 }
                ]
            }
        };

        // --- CÓDIGO NUEVO: CREA UNA LISTA CON ABSOLUTAMENTE TODOS LOS BARES ---
        datosGalicia.bares.galicia = Object.values(datosGalicia.bares).flat();

        let ciudadActual = 'galicia';

        // --- 3. LÓGICA DE FILTRADO Y PINTADO ---
        let markerGroup = L.layerGroup().addTo(map);
        let routeLine = null; 

        function displayData(baresFiltrados, esRuta = false) {
            markerGroup.clearLayers();
            if (routeLine) {
                map.removeLayer(routeLine);
                routeLine = null;
            }

            // --- LÓGICA DE MARCADORES MODIFICADA ---
            const iconoJarra = L.icon({
                iconUrl: 'img/icono_jarra.png', // Asumiendo que has subido esta imagen
                iconSize: [25, 41], 
                iconAnchor: [12, 41],
                popupAnchor: [1, -34] 
            });

            baresFiltrados.forEach((bar, index) => {
                let marker;
                
                // --- Simulación de icono de marcador (Usa la URL real) ---
                const icono_url = 'https://placehold.co/25x41/d93025/FFFFFF?text=' + (index+1);
                
                // Si estamos en la vista de "Toda Galicia", usamos siempre el icono de la jarra
                if (ciudadActual === 'galicia') {
                    marker = L.marker([bar.lat, bar.lon], { icon: iconoJarra });
                }
                // Si estamos en una ciudad y es una ruta de cerveza, usamos el icono numerado
                else if (esRuta) {
                    const jarraNumberIcon = L.divIcon({
                        className: 'jarra-number-marker',
                        html: `<img src="${icono_url}" alt="Jarra"> <span>${index + 1}</span>`, // Usamos la URL simulada
                        iconSize: [60, 35], iconAnchor: [30, 35], popupAnchor: [0, -35]
                    });
                    marker = L.marker([bar.lat, bar.lon], { icon: jarraNumberIcon });
                } else {
                    // Si estamos en una ciudad pero sin filtrar, usamos el pin azul por defecto
                    marker = L.marker([bar.lat, bar.lon]);
                }
                
                const googleMapsLink = `https://maps.google.com/?q=${bar.lat},${bar.lon}`;
                const popupContent = `<b>${bar.nombre}</b><br><strong>Tapa:</strong> ${bar.tapa}<br><i>${bar.direccion || ''}</i><br><a href="${googleMapsLink}" target="_blank" class="popup-link">Cómo llegar</a>`;
                marker.bindPopup(popupContent);
                markerGroup.addLayer(marker);
            });

            // Solo dibujamos la línea si es una ruta DENTRO de una ciudad
            if (baresFiltrados.length > 1 && esRuta && ciudadActual !== 'galicia') {
                const routeCoordinates = baresFiltrados.map(bar => [bar.lat, bar.lon]);
                
                routeLine = L.polyline(routeCoordinates, {
                    color: '#FFC300',      
                    weight: 5,         
                    opacity: 0.9       
                }).addTo(map);

                map.fitBounds(routeLine.getBounds(), {padding: [50, 50]});
            }
        }

        // --- 4. GESTIÓN DE EVENTOS ---
        const filterButtons = document.querySelectorAll('.filter-btn');
        const citySelector = document.getElementById('city-selector');

        function actualizarVista(ciudadId) {
            ciudadActual = ciudadId;
            const ciudad = datosGalicia.ciudades[ciudadActual];
            map.setView(ciudad.centro, ciudad.zoom);
            
            // Al cambiar de ciudad, siempre mostramos todos los bares SIN RUTA
            displayData(datosGalicia.bares[ciudadActual], false);
            
            filterButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('todos').classList.add('active');
        }

        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const filtroId = button.id;
                const baresDeLaVista = datosGalicia.bares[ciudadActual];
                let baresFiltrados = [];
                let esRuta = false;

                if (filtroId === 'todos') {
                    baresFiltrados = baresDeLaVista;
                    if (ciudadActual !== 'galicia') {
                        const ciudad = datosGalicia.ciudades[ciudadActual];
                        map.setView(ciudad.centro, ciudad.zoom);
                    }
                } else if (filtroId === 'estrella' || filtroId === 'mahou' || filtroId === 'aguila') {
                    baresFiltrados = baresDeLaVista
                        .filter(bar => bar.cerveza === filtroId)
                        .sort((a, b) => b.valoracion - a.valoracion);
                    esRuta = true;
                }
                displayData(baresFiltrados, esRuta);
            });
        });

        citySelector.addEventListener('change', (event) => {
            actualizarVista(event.target.value);
        });

        // --- INICIO ---
        // Al cargar la página, inicializamos la vista en "Toda Galicia"
        actualizarVista('galicia');
    </script>
</body>
</html>
